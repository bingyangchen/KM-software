#Command 

一個 Linux 系統中可以存在若干個 users，其中必定會有一個叫做 `root`，`root` 擁有系統中的所有（最高）權限，又叫做 superuser。

`root` 的權限是最高的，非常不建議平時就以 `root` 身份登入系統，因為這麼做的話你執行的應用程式就同樣獲得了所有權限。

>應用程式中永遠都有可能存在 bug 或是 Malware，因此賦予它所有權限是非常危險的！

較好的做法是平時使用 non-root user 登入，有需要取得 `root` 才有的權限時，再行取得權限。

### 取得 `root` 權限

使用指令 `su` 可以取得 `root` user 的權限：

```bash
su
```

但光使用 `su` 並不會讓環境變數跟著變，也就是說你現在還是在原本 user 的環境，只是有了 `root` 的權限而已，如果要連環境一起變成 `root` 的環境（也就是以 `root` 登入的意思），需要在指令中加一個 `-`：

```bash
su -
```

使用 `su` 指令會被要求輸入 `root` user 的密碼，輸入正確後會進入一個新的 shell，如果要離開這個 shell 須使用指令 `exit`。

如果切換為 `root` 後只要簡單執行一個指令便離開，可以使用 `-c` option，如此一來執行完指定的指令後就會離開 `root` 的 shell，舉例如下：

```bash
su - -c "ls"
```

### 取得其他 User 的權限

由於 `root` 又叫 superuser，是所有 user 的管理者，因此 `su` 也可以用來取得任意 user 的權限，指令為：

```bash
su <USERNAME>
```

此時要輸入的密碼是 `<USERNAME>` 的密碼，不過如果已經是在 `root` 環境之下，使用 `su <USERNAME>` 就不用輸入密碼。

# `sudo`

`sudo` 與 `su` 的差別在於輸入的密碼，使用 `su` 要取得 user A 的權限就要輸入的 user A 的密碼；使用 `sudo` 則無論要取得誰的權限都是輸入「目前 user 的密碼」。

`sudo` 在使用上與 `su -c` 類似，在後面直接加上想下的指令，比如：

```bash
sudo ls
```

### Options

加上 `-u` option 則可以取得指定 user 的權限：

```bash
sudo -u <USERNAME> ls
```

加上 `-g` option 可以取的指定 group 的權限：

```bash
sudo -g admin ls
```

### 開啟並持續待在新的 Shell

有些時候我們並不是想要執行一個指令便離開 shell，而是想要持續待在新的 shell 裡，此時就將 `sudo` 與 `su` 合在一起即可：

```bash
# 取得 root 的權限並開啟新 shell
sudo su

# 以 root 身份登入
sudo su -

# 取得其他 user 的權限並開啟新 shell

sudo su <USERNAME>

# 以其他 user 身份登入
sudo su <USERNAME> -
```

### 誰可以用 `sudo`？

「使用 `sudo` 只需輸入目前 user 的密碼」這聽起來很不合理對吧！如果所有 users 都可以使用 `sudo` 切成 `root`，又只須輸入自己的密碼，那豈不是所有 users 想取得所有權限就取得所有權限了嗎？所以其實 Linux 系統中使用了 `/etc` 底下的 `sudoers` 檔案來限制哪些 users 可以使用 `sudo`，檔案中的 pattern 如下：

```plaintext
<USER1> <SOURCE_HOST>=(<USER2>) <COMMAND>
```

上面一行設定使得 `<USER1>` 可以從 `<SOURCE_HOST>` 登入 `<USER2>`，並且只能執行 `<COMMAND>` 這個指令。

如果要設定「`<USER1>` 可以從任意 host 登入任意 user，並使用任意 command」，則需設定為 `<USER1> ALL=(ALL) ALL`。

也可以設定群組的權限，須在最前面加一個 `@`：

```plaintext
@<GROUP> <SOURCE_HOST>=(<USER2>) <COMMAND>
```

> [!Note]
> `/etc/sudoers` 這個檔案只有具有 `root` 權限者可以修改，且若要修改，須使用 `visudo` 這個編輯器來修改，系統會在編輯完成後自動檢查設定檔的語法是否正確，避免錯誤的語法導致 `sudo` 無法使用。

# 新增／修改／刪除 User

### 使用 `useradd` 新增 User

```bash
useradd [<OPTIONS>] <USERNAME>
```

###### Options

- `-g <MAIN_GROUP>`：指定 `<USERNAME>` 所屬的主要群組
- `-G <ADDITIONAL_GROUP>`：指定 `<USERNAME>` 所屬的其它附加群組
- `-e <DATE>`：指定 `<USERNAME>`  的使用期限

e.g.

```bash
useradd -g enginners -G managers -e 2050-12-31 jamison
```

###### 使用 `passwd` 設定 User 的密碼

> [!Note]
> 設定完密碼才算正式啟用 user。

```bash
passwd <USERNAME>
```

### 使用 `userdel` 刪除 User

```bash
userdel [-r] <USERNAME>
```

加上 `-r` option 代表要連同使用者的目錄一起刪除。

### 使用 `usermod` 修改 User

```bash
usermod <OPTIONS> <USERNAME>
```

Option 與新增時一樣有 `-g`、`-G`、`-e`，範例如下：

```bash
usermod -g accountant jamison
```

### 查詢指定 User 的資訊

- **查詢指定 user 的詳細資訊**

    ```bash
    id [<USERNAME>]
    ```

    若不輸入 `<USERNAME>` 則代表查詢目前登入的使用者。

    Output:

    ```plaintext
    uid=0(root) gid=0(wheel) groups=0(wheel), 1(daemon), 2(kmem), 3(sys), 4(tty),5(operator),8(procview),9(procmod),12(everyone),20(staff),29(certusers),61(localaccounts),80(admin),33(_appstore),98(_lpadmin),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae),701(com.apple.sharepoint.group.1)
    ```

- **加上 `-u` option 查詢指定 user 的 username**

    ```bash
    id -u [-n|-r] [<USERNAME>]
    ```

    `-u` 後面再加上 `-n` option 就是 stdout 指定 user 的 username；加上 `-r` option 則是 stdout 指定 user 的「編號」。

- **加上 `-g` option 查詢指定 user 所屬的主要群組**

    ```bash
    id -g [-n|-r] [<USERNAME>]
    ```

- **加上 `-G` option 查詢指定 user 所屬的附加群組**

    ```bash
    id -G [-n|-r] [<USERNAME>]
    ```

    使用 `groups` 也可以查詢所屬的附加群組：

    ```bash
    groups [<USERNAME>]
    ```

### 列出所有 Users

使用下方指令可以列出所有使用者：

```bash
awk -F ':' '{print $1}' /etc/passwd
```

> [!Info]
> 關於使用者與群組的新增／修改／刪除／查詢／列舉，MacOS 的指令與 Linux 不同，關於 MacOS 中的使用者與群組，請見 [[Operating System/MacOS/使用者與群組|使用者與群組]]。

### 查詢目前登入的 User

```bash
whoami
# or
echo $USER
```

# 參考資料

- <https://blog.gtwang.org/linux/sudo-su-command-tutorial-examples/>
- <https://ithelp.ithome.com.tw/articles/10245004>
